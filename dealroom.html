<html>
<head>

    <link type="text/css" href="css/custom-theme/jquery-ui-1.8.16.custom.css" rel="stylesheet"/>
    <link type="text/css" href="css/custom-theme/jive-elements.css" rel="stylesheet"/>
    <link type="text/css" href="css/custom-theme/jive-icons.css" rel="stylesheet"/>
    <link type="text/css" href="css/security-groups.css" rel="stylesheet"/>

    <script type="text/javascript">

// Flag indicating we are in add mode
var adding = true;

// Jive Group selector
var group;

// Jive Project selector
var project;

// Factory for mini messages
var mini;

// Viewer
var viewer;

// On view load, wire up static actions and retrieve initial data
function init() {
    osapi.jive.corev3.people.getViewer({}).execute(function(response) {});
    $("#group-create-button").click(onGroupSave);
    mini = new gadgets.MiniMessage();
}

function onProjectCreated(response) {
    if (response.error) {
        mini.createDismissibleMessage("Error creating new social project: " + response.error.message);
    }
	else
	{
		console.log("Project: "+JSON.stringify(response));
		mini.createDismissibleMessage("Project created with the ID: " + response.id);	
	}
}

function onGroupCreated(response) {
	if (response.error) {
	mini.createDismissibleMessage("Error creating new social group: " + response.error.message);
	}
	
	else
	{
		console.log("Group: "+JSON.stringify(response));
		mini.createDismissibleMessage("Group created at: " + response.html.ref);
		var gMessage = document.getElementById("response-message");
		gMessage.innerHTML = "Click <a href=\""+response.html.ref+"\">here</a> to visit the group";
		// Add GROUP Content-Copying here!
		//Project creation within the newly created group
		var pStartDateAbs = $("#group-name").val(); //Project Start
		var pStartDate = pStartDateAbs.toISOString();
		var pName = response.name;
		var pParent = response.id;
		
		project = {
			"displayName": "",
			"name": "",
			"parent" : "",
			"contentTypes" : [ "documents", "files", "discussions", "polls", "projects", "tasks" ],
			"startDate" : "",
			"dueDate" : ""
		};
		
		project.displayName = pName;
		project.name = "Project for the deal" + pName;
		project.parent = "https://accenture.jiveon.com/groups/" + pParent;
		project.startDate = pStartDate;
		project.dueDate = pStartDate;
		
		osapi.jive.corev3.projects.create(project).execute(onProjectCreated);
	}
}

function onGroupSave() {
    group = {
        displayName : "",
        description : "",
        followerCount : 0,
        groupType : "",
        memberCount : 0,
        name : "",
        type : "group"
    };
    group.description = $("#group-name").val();
    group.description = "This is a deal room created for discussing " + group.description;
    group.displayName = $("#group-name").val();
    group.groupType = "PRIVATE";
    group.contentTypes = [ "documents", "files", "discussions", "projects" ];
    group.name = $("#group-name").val();
    if (adding) {
        osapi.jive.corev3.groups.create(group).execute(onGroupCreated);
    }
}

// Register our on-view-load handler
gadgets.util.registerOnLoadHandler(init);
</script>

</head>

<body>
<div id="wrapper">
    <div id="group-div" class="top-level-div">
        <h3 id="group-header"></h3>
        <table class="j-table">
            <tr>
                <th>Deal Room Name:</th>
                <td>
                    <input id="group-name" class="group-input" type="text" size=50/>
                </td>
            </tr>
            <tr>
                <th>Project Start Date:</th>
                <td>
                    <input id="project-start-date" class="group-input" type="text" size=50/>
                </td>
            </tr>
            <tr>
                <th>Project Due Date:</th>
                <td>
                    <input id="project-due-date" class="group-input" type="text" size=50/>
                </td>
            </tr>			
            <tr>
                <th>&nbsp;</th>
                <td>
                    <button id="group-create-button">Create</button>
                </td>
            </tr>
        </table>
    </div>
	<div id="response-message"></div>
</div>
</body>
</html>